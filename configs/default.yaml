seed: 1337
device: cuda
data:
  dataset: echonet
  root: data/echonet
  frames_per_clip: 16
  frame_size: 128
  fps_subsample: 2
  grayscale: true

synthesis:
  p_apply: 1.0
  gain_min: 0.6
  gain_max: 1.6
  gain_sigma: 0.03

  tgc_K: 6
  tgc_sigma: 0.02
  clip_low_min: 0.00
  clip_low_max: 0.05
  clip_high_min: 0.90
  clip_high_max: 0.99
  add_noise_std: 0.01
  add_noise_mult: 0.02

  # TGC / band style: set to "bands" (default) or "ramp" to keep old behavior
  tgc_style: bands
  tgc_mode: bands            # alias to keep compatibility with prior cfg keys

  # band count
  tgc_bands_min: 1
  tgc_bands_max: 5

  # how strong bands can be (fractional). 0.6 allows intensity in roughly [0.4,1.6]
  tgc_band_strength: 0.5

  # band width (fraction of radial range)
  tgc_band_width_min: 0.06
  tgc_band_width_max: 0.28

  # probability a band is abrupt (box-like) vs smooth (Gaussian)
  tgc_abrupt_prob: 0.15
  tgc_abrupt_sharpness: 20.0

  # lateral waviness and time jitter
  tgc_lateral_perturb: 0.06
  tgc_time_jitter: 0.02

  # curvature center (multiplier of image height) -> >1 places circle center below image
  tgc_curvature: 1.3

  # overall TGC strength blending (0=no band effect, 1=full effect)
  tgc_strength: 0.5

  tgc_widen_factor: 1.6

  mask_thresh: 0.01
  mask_widen: 7

  tgc_min_mul: 0.35            # avoid extreme multiplicative darkening
  tgc_max_mul: 2.0             # keep upper bound reasonable
  tgc_min_residual: 0.06       # minimum brightness after normalization (prevent exact black)
  tgc_preserve_blend: 0.12     # blend a bit of pre-normalized texture back in

train:
  debug: true
  amp: false
  batch_size: 6
  num_workers: 4
  epochs: 15
  lr_g: 2e-4
  lr_d: 1e-4         # stronger D can help but watch stability
  weight_decay: 0 # 1e-4
  save_dir: runs/exp7_lowerIdentity_tv
  grad_clip: 1.0
  d_steps: 1        # more D steps per G step

model:
  enc_channels: [32, 64, 128]
  n_heads: 4
  n_layers: 2
  lowrank_rank: 8
  illumination_coarse: 16

loss:
  w_l1: 0.25          # down from 1.0
  w_ssim: 0.00
  w_tv: 0.001         # down from 0.1
  w_identity: 0.02
  w_lowrank_nuc: 0.000  # down from 0.05
  lambda_adv: 2.0   # slightly stronger adv signal
  w_fm: 5.0         # feature-matching weight
  w_edge: 0.1      # gradient/edge loss weight
  w_l1_masked: 2.0
  w_l1_bg: 0.05

eval:
  ckpt: null
